---
---

<div>
    <div>
        <div id="drop-region" class="bg-slate-200 dark:bg-teal-800">
            <div class="drop-message">
                Drag & Drop images or click to upload
            </div>
            <div id="image-preview"></div>
        </div>
        <div id="style-region"></div>
    </div>
    <div>
        <button id="crop-button" disabled></button>
    </div>
</div>

<style>
    #drop-region {
        border-radius: 20px;
        box-shadow: 0 0 35px rgba(0, 0, 0, 0.05);
        width: 400px;
        padding: 60px 40px;
        text-align: center;
        cursor: pointer;
        transition: 0.3s;
    }
    #drop-region:hover {
        box-shadow: 0 0 45px rgba(0, 0, 0, 0.1);
    }

    #image-preview {
        margin-top: 20px;
    }
    #image-preview .image-view {
        display: inline-block;
        position: relative;
        margin-right: 13px;
        margin-bottom: 13px;
    }
    #image-preview .image-view img {
        max-width: 100px;
        max-height: 100px;
    }
    #image-preview .overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        right: 0;
        z-index: 2;
        background: rgba(255, 255, 255, 0.5);
    }
</style>

<script>
    let imageData: File;
    let // where files are dropped + file selector is opened
        dropRegion = document.getElementById("drop-region"),
        // where images are previewed
        imagePreviewRegion = document.getElementById("image-preview"),
        //preview button
        cropButton = document.getElementById("crop-button");
        ;

    // open file selector when clicked on the drop region
    let fakeInput = document.createElement("input");
    fakeInput.type = "file";
    fakeInput.accept = "image/*";
    fakeInput.multiple = true;
    dropRegion?.addEventListener("click", function () {
        fakeInput.click();
    });

    fakeInput.addEventListener("change", function () {
        let files = fakeInput.files;
        handleFiles(files!);
    });

    function preventDefault(e: Event) {
        e.preventDefault();
        e.stopPropagation();
    }

    dropRegion?.addEventListener("dragenter", preventDefault, false);
    dropRegion?.addEventListener("dragleave", preventDefault, false);
    dropRegion?.addEventListener("dragover", preventDefault, false);
    dropRegion?.addEventListener("drop", preventDefault, false);

    function handleDrop(e: DragEvent) {
        let dt = e.dataTransfer,
            files = dt?.files;

        handleFiles(files!);
    }

    dropRegion?.addEventListener("drop", handleDrop, false);

    function handleFiles(files: FileList) {
        if (files.length > 0) {
            let image = files[0] as File;
            if (validateImage(image)) {
                previewAnduploadImage(image);
            }
        }
    }

    function validateImage(image: File) {
        // check the type
        let validTypes = ["image/jpeg", "image/png", "image/gif"];
        if (validTypes.indexOf(image.type) === -1) {
            alert("Invalid File Type");
            return false;
        }

        // check the size
        let maxSizeInBytes = 10e6; // 10MB
        if (image.size > maxSizeInBytes) {
            alert("File too large");
            return false;
        }

        return true;
    }

    function previewAnduploadImage(image: File) {
        if (imagePreviewRegion?.hasChildNodes()) {
            imagePreviewRegion.removeChild(imagePreviewRegion.firstChild!);
        }
        // container
        let imgView = document.createElement("div");
        imgView.className = "image-view";
        imagePreviewRegion?.appendChild(imgView);

        // previewing image
        let img = document.createElement("img");
        imgView.appendChild(img);

        // progress overlay
        let overlay = document.createElement("div");
        overlay.className = "overlay";
        imgView.appendChild(overlay);

        // read the image...
        let reader = new FileReader();
        reader.onload = function (e) {
            img.src = e.target?.result as string;
        };
        reader.readAsDataURL(image);

        cropButton?.removeAttribute("disabled");
        // create FormData
        imageData = image;
    }
</script>
